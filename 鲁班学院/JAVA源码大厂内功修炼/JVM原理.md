 

## 课程要点

### class文件被加载后在内存中是如何存储的

#### 类加载的阶段

##### 1加载

将 .class 文件从磁盘读取到内存

##### 2连接

###### 2.1验证

验证 class 字节码文件的正确性（魔数）

###### 2.2准备

给类的静态变量分配内存，并赋予默认值

###### 2.3解析

类装载器装入类所引用的其他类（静态链接）

##### 5初始化

为类的静态变量赋予正确的初始值，上述的准备阶段为静态变量赋予的是虚拟机默认的初始值，此处赋予的才是程序编写者为变量分配的真正的初始值，执行静态代码块

##### 6使用

##### 7卸载

#### 四个概念

##### 1 class文件

​	编译后生成的文件，存储在磁盘中

##### 2 class content

​	加载阶段，将class文件加载到内存

​	可以理解为class文件在内存中的格式

​	char *buff = calloc

​	操作系统的内存

##### 3 class对象

​	Class clazz = Test.class

​	class对象在哪个区？

​		堆区

##### 4 对象

​	new 生成的一个对象

​	Test demo = new Test();

#### class 文件在内存中是如何存储的？

instanceKlass

​	方法区

​	常量池

​	元信息

instanceMirrorKlass

​	镜像类

class对象就是instanceMirrorKlass类的实例，堆区

### 方法区、永久区、元空间、热点代码缓存区

方法区是理论（规范、接口），永久区、元空间是具体实现（实现类）

永久代--在jdk7以前，由堆区管理

元空间--在jdk8开始，在操作系统内存

#### 为什么在jdk8后改为元空间

​	1. gc问题

​	2. 应用问题，涉及到调优以及动态生成（ASM、Cglib），动态生成的类是存储在堆区中的，容易导致OOM（内存泄漏），元空间可降低OOM发生概率

### 精讲虚拟机栈：动态链接、返回现场



### 堆、进入老年代的情况、GC



### 类加载器、运行时数据区、程序计数器如何协调工作



### 理清虚拟机栈、方法区、堆区之间的关联



## 几道面试题

### 给局部变量赋值时直接操作局部变量表就行了，为什么要借助操作数栈实现



### this指针是何时赋值的



### JVM是用C++实现的，C++生成的对象是放在操作系统内存中的，怎么放到JVM堆上的



### 栈帧中的动态链接中存储的是什么？还有其他思路吗？



### oop最大支持的堆大小是多少？如何扩容？